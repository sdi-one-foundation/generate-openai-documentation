name: 'Auto Release Notes'
description: 'Github action to have auto release notes published to Microsoft Teams'
inputs:
  service-name:
    description: 'Name of service being deployed.'
    required: true
  team-name:
    description: 'Name of team that owns application.'
    required: true
runs:
  using: "composite"
  steps:
    - name: Publish OpenAPI Documentation
      if: ${{ inputs.environment == 'production' }}
      shell: bash
      run: |
         eval `ssh-agent -s`
         ssh-add - <<< '${{ secrets.CENTRALIZED_OPENAPI_SPEC_REPO_DEPLOY_PRIVATE_KEY }}'
         git clone git@github.com:sdi-one-architecture/centralized-openapi-specs.git
         cp target/generated-api/${{ inputs.service-name }}.openapi.json centralized-openapi-specs/${{ inputs.team-name }}/
         cd centralized-openapi-specs
         git config --global user.email "${{ secrets.DEVOPS_BOT_EMAIL }}"
         git config --global user.name "${{ secrets.DEVOPS_BOT_USERNAME }}"
         git add ${{ inputs.team-name }}/${{ inputs.service-name }}.openapi.json
         if git diff-index --quiet HEAD; then
            echo "No changes to commit"
         else
            git commit -m "docs: Update OpenAPI specs for ${{ inputs.service-name }}"
            git push
         fi

